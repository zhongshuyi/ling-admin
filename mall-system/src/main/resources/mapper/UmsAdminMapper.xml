<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mall.system.mapper.UmsAdminMapper">

    <select id="getUserListByRoleId" resultType="com.mall.system.entity.UmsAdmin">
        select u.id,
               username,
               real_name,
               email,
               tel,
               sex,
               concat(uf.path, '/', uf.name, uf.postfix) as avatar,
               avatar_file_id,
               status,
               del_flag,
               depart_ids,
               user_identity,
               u.remark
        from ums_admin u
                 join ums_user_role uur on u.id = uur.user_id
                 left join ums_file uf on u.avatar_file_id = uf.id
        where uur.role_id = #{roleId}
    </select>

    <select id="queryUserList" resultType="com.mall.system.entity.UmsAdmin">
        SELECT u.id,
        username,
        real_name,
        u.email,
        tel,
        sex,
        concat(uf.path, '/', uf.name, uf.postfix) as avatar,
        avatar_file_id,
        status,
        del_flag,
        depart_ids,
        user_identity,
        u.remark
        FROM ums_admin u
        join ums_user_dept uud on u.id = uud.user_id
        join ums_dept ud on uud.dept_id = ud.id
        left join ums_file uf on u.avatar_file_id = uf.id
        <where>
            u.del_flag = 0
            <if test="deptId!=null">
                and ud.parent_list like CONCAT((select parent_list from ums_dept where id = #{deptId}),'%')
            </if>
            <if test="username!=null and username != ''">
                and username like CONCAT(#{username},'%')
            </if>
            <if test="realName!=null and realName != ''">
                and real_name like CONCAT(#{realName},'%')
            </if>
        </where>
        order by u.id
    </select>
    <select id="getUmsAdminByUserName" resultType="com.mall.system.entity.UmsAdmin">
        select u.id,
               username,
               real_name,
               email,
               tel,
               sex,
               concat(uf.path, '/', uf.name, uf.postfix) as avatar,
               avatar_file_id,
               password,
               status,
               del_flag,
               depart_ids,
               user_identity,
               u.remark
        from ums_admin u
                 left join ums_file uf on u.avatar_file_id = uf.id
        where u.username = #{username};
    </select>
    <select id="getUmsAdminById" resultType="com.mall.system.entity.UmsAdmin">
        select u.id,
               username,
               real_name,
               email,
               tel,
               sex,
               concat(uf.path, '/', uf.name, uf.postfix) as avatar,
               avatar_file_id,
               password,
               status,
               del_flag,
               depart_ids,
               user_identity,
               u.remark
        from ums_admin u
                 left join ums_file uf on u.avatar_file_id = uf.id
        where u.id = #{userId}
    </select>

    <select id="getUserAvatar" resultType="java.lang.String">
        select concat(uf.path, '/', uf.name, uf.postfix) as avatar
        from ums_admin u
                 left join ums_file uf on u.avatar_file_id = uf.id
        where u.id = #{userId}
    </select>


</mapper>
